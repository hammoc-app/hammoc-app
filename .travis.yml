language: elixir
elixir: '1.8.0'
otp_release: '21.1.1'

before_install:
  - docker run -d --name postgres11 -p 5432:5432 postgres:11.1
  - docker exec -i postgres11 bash <<< 'until pg_isready -U postgres > /dev/null 2>&1 ; do sleep 1; done'

jobs:
  include:
    - stage: compile
      script: mix compile
    - stage: test
      script: mix credo
    - stage: test
      script: mix format --check-formatted --dry-run
    - stage: test
      script: mix dialyzer --halt-exit-status

cache:
  directories:
    - _build
    - deps
